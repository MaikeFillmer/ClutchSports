<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Clutch Sports</title>
	<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="stylesheet" href="assets/css/reset.css">

</head>


<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
	<div class="container-fluid">
 	<!-- Brand and toggle get grouped for better mobile display -->
	<div class="navbar-header">
     
       <a class="navbar-brand" href="#home">Back to the top</a>
     </div>
 
     <!-- Collect the nav links, forms, and other content for toggling -->
     <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
       <ul class="nav navbar-nav">
         
       </ul>
       
       <ul class="nav navbar-nav navbar-right">
 		 <li class="active"><a href="#page1">Events <span class="sr-only">(current)</span></a></li>
         <li><a href="#page2">News</a></li>
 
       </ul>
     </div><!-- /.navbar-collapse -->
   </div><!-- /.container-fluid -->
 </nav>

	<section id="home" data-type="background" data-speed="10" class="pages">
	
	<div class="row">

	<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
 		
 		</div>
 
 		<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
 		<div class="jumbotron" id="jumbotronID">
		<div class="container">
			<h1 class="text-center">Clutch Sports</h1>

			<h4 class="text-center">Search a sports team to get info.</h4>
		</div>
	</div>
	</div>
	</div>

	<div class="row">
	
		<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
	
		</div>

		<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
		
			<form>
  			<div class="form-group">
    		<label for="sportsSearch" id="sportsSearch">Enter a Sports Team</label>
   			 <input type="team" class="form-control" id="teamName" placeholder="Team">
  			<br>
  			<button type="submit" class="btn btn-default" id="search"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Search</button>
			</form>

		</div>
		
	</div>
	</section>

	<section id="page1" data-type="background" data-speed="10" class="pages">
	<div class="container">
	<div class="row">
	
		

		<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5" id="events">
		
		<h2>Upcoming Events</h2>
		<div id="eventsText">
		
		</div>
		</div>
		<div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
 	
 		</div>
		

		<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5" id="socialMedia">
		<h2>Trending Tweets</h2>
		
		</div>

	</div>
	</div>
	</section>

	<section id="page2" data-type="background" data-speed="10" class="pages">
	<div class="container">
	<div class="row">
		
		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" id="newsArticles">
		
			<h2 class="text-center">News Articles</h2>
			<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" id="newsLeft">
			</div>
			<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" id="newsCenter">
			</div>
			<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" id="newsRight">
			</div>
		</div>


	</div>
	</div>
	</section>	


</body>



<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.js"></script>
<script type="text/javascript" src="assets/javascript/logic.js"></script>

<script type="text/javascript">
	
</script>
<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
	<script src='http://code.jquery.com/jquery-2.1.3.min.js'></script>
	<script type="text/javascript">

//Presentation: concept, design process, how it work, describe use case using a demo
		

		function toNiceDate(string) {
            		var splitString = string.split('T').join(' ')
            		var date = moment(splitString).format("ddd, M/D h:mmA")
            		return date;
            	}
	$('#search').on('click', function() {
		var search = $('#teamName').val().trim();;

		search = search.split(' ').join('-');

		console.log(search);

		var queryURL = "https://api.seatgeek.com/2/events?performers.slug=" + search + "&client_id=NDM2Nzc5M3wxNDU4MjU1NzU4";
		console.log(queryURL);
        $.ajax({
                url: queryURL,
                method: 'GET'
            })
            .done(function(response) {
            	$('#eventsText').empty();
            	ticketResults = [];
         	    console.log(response.events.length);

         	    if(response.events.length == 0){ //will not show any results if none were found
         	    	$("#eventsText").text("No Tickets Available in the Near Future")

         	    }
         	    else{
            	for(i=0;i<10;i++){
            		ticketResults[i] = {
            			name: response.events[i].title,
            			location: response.events[i].venue.display_location,
            			time: toNiceDate(response.events[i].datetime_local),
            			url: response.events[i].url
            		}

            		var ticketDiv = $('<div class="item" data-number=' + i+'>')
	            	var h = $('<h3>').text(ticketResults[i].name);
	            	var l = $('<p>').text(ticketResults[i].location);
	            	var t = $('<p>').text(ticketResults[i].time);
	            	ticketDiv.append(h, l, t);
	            	$("#eventsText").append(ticketDiv);
	            }
	           	console.log(ticketResults);
	           }
     			
        });
				search = search.split('-').join('+');
				console.log(search);
				//AJAX call to search for news articles
				$.ajax({
		        url: 'https://www.googleapis.com/customsearch/v1?q=' + search + '&cx=011101858926978562708%3Abyfxhjvymhs&key=AIzaSyCosQeZ1wcWPFJGUlzPMfsAVGHzttA4YDQ',
		        method: 'GET'
		     }).done(function(response) {
		      //Gets 9 articles from response
		      for(var i = 1; i < 10; i++)
		      {
		      	//Stores object data of the articles
		        var currentStory = response.items[i];
		        //Stores data pulled from the page of the article
		        var currentStoryPagemap = response.items[i].pagemap;
		        //The all encompassing div that contains all data for a particular story
		        var newsDiv = $('<div>');
		        newsDiv.addClass('well');
		        //The title of the news story
		        var newsTitle = $('<h3>');
		        newsTitle.addClass('newsTitle');
		        newsTitle.html(currentStoryPagemap.article[0].name);
		        //Adds news title to the individual news story div
		        newsDiv.append(newsTitle);
		        //The article body. A snippet of the actual article. Will contain the thumbnail image in the p tag for formatting
						var newsBody = $('<p>');
						//Thumbnail image tag
		        var newsImg = $('<img>');
		        newsImg.attr('src', currentStoryPagemap.cse_thumbnail[0].src);
		        newsImg.addClass('newsPics');
		        newsBody.append(newsImg);
		        newsBody.addClass('articlebody');
		        newsBody.append(currentStoryPagemap.article[0].articlebody);
		        //Adds the body, containing snippet and image, to individual news story div
		        newsDiv.append(newsBody);
		        newsDiv.append('<br>');
		        //The link to the article on bleacherreport
		        var newsLink = $('<a>');
		        newsLink.addClass('newsLink');
		        newsLink.attr('href', currentStoryPagemap.article[0].url)
		        newsLink.html('read more');
		        //Appends the link to the individual news story div
		        newsDiv.append(newsLink);
		        //Date the article was published
		        var datePub = $('<p>');
        		datePub.addClass('datePub');
        		datePub.html("Date: " +currentStoryPagemap.article[0].datepublished);
        		//Appends date to news story div
        		newsDiv.append(datePub);
        		//Displays news stories horizontally, 3 per row
		        if(i == 1 || i == 4 || i == 7)
		        {
		          $('#newsLeft').append(newsDiv);
		        }
		        if(i == 2 || i == 5 || i == 8)
		        {
		          $('#newsCenter').append(newsDiv);
		        }
		        if(i == 3 || i == 6 || i == 9)
		        {
		          $('#newsRight').append(newsDiv);
		        }
		      }
		     });	
				return false;		//will keep results and not auto refresh
		  });
          
		window.onload = function(){
	        var today = moment().format("YYYY-MM-DD");

	        console.log(today);
	        var queryURL2 = "https://api.seatgeek.com/2/events?taxonomies.name=sports&datetime_utc.gt=" + today;

			$.ajax({
	                url: queryURL2,
	                method: 'GET'
	            })
	            .done(function(response) {
	            	console.log(response)
	            	$('#eventsText').empty();
	            	ticketResults2=[];
	            	for(i=0;i<10;i++){
	            		ticketResults2[i] = {
	            			name: response.events[i].title,
	            			location: response.events[i].venue.display_location,
	            			time: toNiceDate(response.events[i].datetime_local),
	            			url: response.events[i].url
	            		}
	            		var ticketDiv = $('<div class="item2" data-number=' + i+'>')
		            	var h = $('<h3>').text(ticketResults2[i].name);
		            	var l = $('<p>').text('Location:  ' 
		            		+ ticketResults2[i].location);
		            	var t = $('<p>').text('Time:  ' + ticketResults2[i].time);
		            	var u = 
		            	ticketDiv.append(h, l, t);
		            	$("#eventsText").append(ticketDiv);
	            	}
	            	console.log(ticketResults2);
	            });
	        };


	        $('body').on('click', '.item', function() {
	        	var index = $(this).data('number');
	        	window.location = ticketResults[index].url;

	        });
	        $('body').on('click', '.item2', function() {
	        	var index = $(this).data('number');
	        	window.location = ticketResults2[index].url;

	        });


	</script>
</html>

